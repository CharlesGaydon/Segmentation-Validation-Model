<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Production process used to transform point clouds classification &mdash; lidar_prod V1.9.10 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/sphinx_paramlinks.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
        <script>mermaid.initialize({startOnLoad:true});</script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Strategy to find optimal decision thresholds for Building validation" href="thresholds_optimization_process.html" />
    <link rel="prev" title="Overview of the process" href="overview.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> lidar_prod
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Background</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview of the process</a><ul>
<li class="toctree-l2"><a class="reference internal" href="overview.html#schema-of-the-overall-process">schema of the overall process</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Production process used to transform point clouds classification</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#a-1-vegetation-detection">A.1) Vegetation detection</a></li>
<li class="toctree-l2"><a class="reference internal" href="#a-2-unclassified-detection">A.2) Unclassified detection</a></li>
<li class="toctree-l2"><a class="reference internal" href="#b-building-module">B) Building Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="#b-1-building-validation">B.1) Building Validation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#b-2-building-completion">B.2) Building Completion</a></li>
<li class="toctree-l2"><a class="reference internal" href="#b-3-building-identification">B.3) Building Identification</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="thresholds_optimization_process.html">Strategy to find optimal decision thresholds for Building validation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="thresholds_optimization_process.html#motivations">Motivations</a></li>
<li class="toctree-l2"><a class="reference internal" href="thresholds_optimization_process.html#strategy">Strategy</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/install.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/install.html#set-up-a-virtual-environment">Set up a virtual environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/install.html#install-the-app-as-a-python-module">Install the app as a python module</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/use.html">Using the app</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/use.html#run-within-a-docker-container">Run within a docker container</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/use.html#run-as-a-python-module">Run as a python module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/use.html#run-from-source-directly">Run from source directly</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/use.html#run-different-tasks">Run Different tasks</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../guides/thresholds_optimization.html">How to optimize building validation decision thresholds?</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../guides/thresholds_optimization.html#requirements">Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/thresholds_optimization.html#running-thresholds-optimization">Running thresholds optimization</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../guides/development.html">Developer’s guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../guides/development.html#code-versionning">Code versionning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/development.html#tests">Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/development.html#continuous-integration-ci">Continuous Integration (CI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/development.html#continuous-delivery-cd">Continuous Delivery (CD)</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Package Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../apidoc/lidar_prod.html">lidar_prod.run</a></li>
<li class="toctree-l1"><a class="reference internal" href="../apidoc/lidar_prod.tasks.html">lidar_prod.tasks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../apidoc/lidar_prod.tasks.html#module-lidar_prod.tasks.building_validation">building_validation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../apidoc/lidar_prod.tasks.html#module-lidar_prod.tasks.building_validation_optimization">building_validation_optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../apidoc/lidar_prod.tasks.html#module-lidar_prod.tasks.building_completion">building_completion</a></li>
<li class="toctree-l2"><a class="reference internal" href="../apidoc/lidar_prod.tasks.html#module-lidar_prod.tasks.building_identification">building_identification</a></li>
<li class="toctree-l2"><a class="reference internal" href="../apidoc/lidar_prod.tasks.html#module-lidar_prod.tasks.cleaning">cleaning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../apidoc/lidar_prod.tasks.html#module-lidar_prod.tasks.utils">utils</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../apidoc/lidar_prod.commons.html">lidar_prod.commons</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../apidoc/lidar_prod.commons.html#module-lidar_prod.commons.commons">lidar_prod.commons.commons module</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../configs.html">Default configuration</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">lidar_prod</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Production process used to transform point clouds classification</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/background/production_process.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="production-process-used-to-transform-point-clouds-classification">
<h1>Production process used to transform point clouds classification<a class="headerlink" href="#production-process-used-to-transform-point-clouds-classification" title="Permalink to this headline"></a></h1>
<p>The end goal of the tool is to edit the input (rule-based) classification as much as we confidently can, and to highlight remaining areas of uncertainty for human inspection.</p>
<p><strong>Input</strong>: point cloud that went through a first geometric algorithm that identified <code class="docutils literal notranslate"><span class="pre">candidates</span> <span class="pre">building</span> <span class="pre">points</span></code> based on geometric rules (e.g. plane surfaces, above 1.5m of the ground, etc.), and for which a semantic segmentation model produced a point-level probability of being a building, vegetation and/or unclassified, and calculate the associated entropy. The default name for those extra dimensions are <code class="docutils literal notranslate"><span class="pre">building</span></code>, <code class="docutils literal notranslate"><span class="pre">vegetation</span></code>, <code class="docutils literal notranslate"><span class="pre">unclassified</span></code> and <code class="docutils literal notranslate"><span class="pre">entropy</span></code> respectively. You can leverage this <a class="reference external" href="https://github.com/IGNF/lidar-deep-segmentation">package for aerial lidar deep learning segmentation</a>.</p>
<section id="a-1-vegetation-detection">
<h2>A.1) Vegetation detection<a class="headerlink" href="#a-1-vegetation-detection" title="Permalink to this headline"></a></h2>
<p><strong>Goal</strong>: Confirm or refute points as vegetation.</p>
<p>The identification is done by comparing the vegetation probability  of a point against a <code class="docutils literal notranslate"><span class="pre">threshold</span></code>. That threshold has been previously established as the best on a test set of las files.</p>
</section>
<section id="a-2-unclassified-detection">
<h2>A.2) Unclassified detection<a class="headerlink" href="#a-2-unclassified-detection" title="Permalink to this headline"></a></h2>
<p><strong>Goal</strong>: Confirm or refute points as unclassified.</p>
<p>Exactly as with vegetation detection, the identification is done by comparing the unclassified probability of a point against a <code class="docutils literal notranslate"><span class="pre">threshold</span></code>. That threshold has been previously established as the best on a test set of las files.</p>
</section>
<section id="b-building-module">
<h2>B) Building Module<a class="headerlink" href="#b-building-module" title="Permalink to this headline"></a></h2>
<p><img alt="" src="../_images/lidar-prod-M11.1_BuildingModuleIllustration.png" /></p>
</section>
<section id="b-1-building-validation">
<h2>B.1) Building Validation<a class="headerlink" href="#b-1-building-validation" title="Permalink to this headline"></a></h2>
<p><strong>Goal</strong>: Confirm or refute groups of candidate building points when possible, mark them as unsure elsewise.</p>
<ol class="arabic simple">
<li><p>Clustering of <em>candidate buildings points</em> into connected components.</p></li>
<li><p>Point-level decision</p>
<ol class="arabic simple">
<li><p>Identification of points with ambiguous probability: <code class="docutils literal notranslate"><span class="pre">high</span> <span class="pre">entropy</span></code> if entropy &gt;= E1</p></li>
<li><p>Identification of points that are <code class="docutils literal notranslate"><span class="pre">overlayed</span></code> by a building vector from the database.</p></li>
<li><p>Decision at the point-level based on probabilities :</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">confirmed</span></code> if:</p>
<ol class="arabic simple">
<li><p>p&gt;=<code class="docutils literal notranslate"><span class="pre">C1</span></code>, or</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">overlayed</span></code> and p&gt;= (<code class="docutils literal notranslate"><span class="pre">C1</span></code> * <code class="docutils literal notranslate"><span class="pre">Cr</span></code>), where <code class="docutils literal notranslate"><span class="pre">Cr</span></code> is a relaxation factor that reduces the confidence we require to confirm when a point overlayed by a building vector.</p></li>
</ol>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">refuted</span></code> if (1-p) &gt;= <code class="docutils literal notranslate"><span class="pre">R1</span></code></p></li>
</ol>
</li>
</ol>
</li>
<li><p>Group-level decision :</p>
<ol class="arabic simple">
<li><p>Uncertain due to high entropy: if proportion of <code class="docutils literal notranslate"><span class="pre">high</span> <span class="pre">entropy</span></code> points &gt;=  <code class="docutils literal notranslate"><span class="pre">E2</span></code></p></li>
<li><p>Confirmation: if proportion of <code class="docutils literal notranslate"><span class="pre">confirmed</span></code> points &gt;= <code class="docutils literal notranslate"><span class="pre">C2</span></code> OR if proportion of <code class="docutils literal notranslate"><span class="pre">overlayed</span></code> points &gt;= <code class="docutils literal notranslate"><span class="pre">O1</span></code></p></li>
<li><p>Refutation: if proportion of <code class="docutils literal notranslate"><span class="pre">refuted</span></code> points &gt;= <code class="docutils literal notranslate"><span class="pre">R2</span></code> AND proportion of <code class="docutils literal notranslate"><span class="pre">overlayed</span></code> points &lt; <code class="docutils literal notranslate"><span class="pre">O1</span></code></p></li>
<li><p>Uncertainty: elsewise (this is a safeguard: uncertain groups are supposed to be already captured via their entropy)</p></li>
</ol>
</li>
<li><p>Update of the point cloud classification</p></li>
</ol>
<p>Decision thresholds <code class="docutils literal notranslate"><span class="pre">E1</span></code>, <code class="docutils literal notranslate"><span class="pre">E2</span></code> , <code class="docutils literal notranslate"><span class="pre">C1</span></code>, <code class="docutils literal notranslate"><span class="pre">C2</span></code>, <code class="docutils literal notranslate"><span class="pre">R1</span></code>, <code class="docutils literal notranslate"><span class="pre">R2</span></code>, <code class="docutils literal notranslate"><span class="pre">O1</span></code> are chosen via a <a class="reference internal" href="thresholds_optimization_process.html"><span class="doc std std-doc">multi-objective hyperparameter optimization</span></a> that aims to maximize automation, precision, and recall of the decisions.
Current performances on a 15km² test dataset, expressed as percentages of clusters, are:</p>
<ul class="simple">
<li><p>Automation=86.5%</p></li>
<li><p>Precision&gt;=98%</p></li>
<li><p>Recall&gt;=98%.</p></li>
</ul>
</section>
<section id="b-2-building-completion">
<h2>B.2) Building Completion<a class="headerlink" href="#b-2-building-completion" title="Permalink to this headline"></a></h2>
<p><strong>Goal</strong>: Confirm points that have high-enough probability, but where not confirmed because</p>
<ul class="simple">
<li><p>(a) they were too scattered for clustering during validation, or</p></li>
<li><p>(b) they were not candidate buildings points.</p></li>
</ul>
<p>Cluster high-proba points (p &gt;= 0.5) with previously confirmed building points in a vertical fashion (XY plan).
For each cluster that includes already confirmed points, the rest (i.e. high probability points) are considered to belong to the same building. Then, it is one of two things:</p>
<ul class="simple">
<li><p>If (a), then these candidate points are confirmed.</p></li>
<li><p>If (b), then these non-candidate points are added as a Group, for later human inspection/confirmation. This is to avoid a direct modification of the Classification dimension taking place outside of the scope of buildings detected in rule- based software.</p></li>
</ul>
</section>
<section id="b-3-building-identification">
<h2>B.3) Building Identification<a class="headerlink" href="#b-3-building-identification" title="Permalink to this headline"></a></h2>
<p><strong>Goal</strong>: Highlight potential buildings that were missed by the rule-based algorithm, for human inspection.</p>
<p>Among points that were <strong>not</strong> <em>candidate buildings points</em> and not already confirmed, identify those with high enough probabiltity (p &gt;= 0.5) and cluster.</p>
<p>This clustering defines a LAS extra dimensions (<code class="docutils literal notranslate"><span class="pre">Group</span></code>) which indexes newly found cluster that may be buildings.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="overview.html" class="btn btn-neutral float-left" title="Overview of the process" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="thresholds_optimization_process.html" class="btn btn-neutral float-right" title="Strategy to find optimal decision thresholds for Building validation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Institut National de l&#39;Information Géographique et Forestière.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>